<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button  style="color: #ff28e9;" icon="chevron-back"></ion-back-button>
    </ion-buttons>
    <ion-thumbnail (click)="viewProfile()" style=" --border-radius: 50%;" slot="start">
      <img  src={{profilePic}}/>
    </ion-thumbnail>
    <ion-label class="ion-text-wrap">
      <p (click)="viewProfile()" style="color: white; margin-left: 10px;">{{name}}</p>
      <p [class]="status == 'online' ? 'online-status' : 'offline-status'" style="margin-left: 10px;">{{status}}</p>
    </ion-label>
  </ion-toolbar>
</ion-header>

<ion-content #content [scrollEvents]="true" [fullscreen]="true" class="ion-text-center" [scrollY]="true">

  <div id="record" class="record-window" style="display: flex; align-items: center; justify-content: center; opacity: 0">
    <div style="background-color: white; width: 40%; height: 20%; border-radius: 20px; display: flex;">
      <div id="ring" [class]="record ? 'ring' : ''" style="position: relative; top: 50%; left: 50%; border-radius: 50%; transform: translate(-50%, -50%); background: none; border: 2px solid #2dd36f;">

      </div>
      <div style="position: fixed; top: 50%; left: 50%; border-radius: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; background: none; border: 2px solid #2dd36f;">

      </div>
      <ion-icon (click)="cancelRecord()" slot="icon-only" style="position: fixed; top: 42%; left: 66%; transform: translate(-66%, -42%); width: 20px; height: 20px; color: #2dd36f;" name="close"></ion-icon>
      <ion-icon style="width: 30px; height: 30px; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #2dd36f;" name="mic"></ion-icon>
    </div>
  </div>

  <ion-icon [class]="textMsg.length > 0 && record == false ? 'side-btn-slide' : 'side-btn-normal'" id="mic-btn" name="mic" (click)="audioRecord()"></ion-icon>
  <ion-icon [class]="textMsg.length > 0 && record == false ? 'side-btn-slide' : 'side-btn-normal'" id="attach-btn" name="attach" (click)="openAttachModal()"></ion-icon>

  <ion-list id="chatContainer" style="background: none; width: 100%; overflow-y: scroll;">
    <ion-item lines="none" *ngFor="let chat of chats; let i = index" style="--background: none; display: flex; align-items: flex-start; justify-content: flex-start; width: 100%; ">
      <div *ngIf="chat.sender != uid" style="display: flex; align-items:flex-start; justify-content:flex-start; width: 100%;">
          <p *ngIf="chat.type == 'text'" class="msg" style="font-size: 1.1rem; font-weight: 500; max-width: 80%; background: linear-gradient(90deg, hsl(264, 100%, 61%), hsl(293, 100%, 63%)); border-radius: 0.7rem 0.7rem 0.7rem 0.2rem;">{{chat.textMessage}}</p>
          <div *ngIf="chat.type == 'application'" (click)="openDoc(chat, i)" class="msg" style="padding-top: 0rem; padding-bottom: 0rem; display: flex; flex-direction: row; min-width: 70%; max-width: 70%; background: #541585; border-radius: 0.5rem 0.5rem 0.5rem 0.2rem;">
            <ion-row>
              <ion-col size="1">
                <ion-spinner style="width: 20px; height: 20px; position: relative; top: 15px;" *ngIf="chat.fileDownload == true" name="crescent" color='secondary'></ion-spinner>
                <fa-icon style="position: relative; top: 15px;" *ngIf="chat.fileDownload == false" [icon]="chat.fileType"></fa-icon>
              </ion-col>
              <ion-col size="11">
                <p style="max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{chat.fileName}}</p>
              </ion-col>
            </ion-row>
          </div>
          <div (click)="streamAudio(chat.textMessage)" *ngIf="chat.type == 'audio'" style="max-height: 80px; padding-left: 5px; padding-right: 5px; margin: 0.25rem 0; border-radius: 0.5rem 0.5rem 0.5rem 0.2rem; background: #541585; color: white; width: 70%;">
            <ion-row style="max-width: 100%; text-overflow: ellipsis; position: relative; top: -5px;">
              <ion-col size='1'>
                <ion-icon name="headset" style="margin-bottom: -20px;"></ion-icon>
              </ion-col>
              <ion-col size='11' style="padding-left: 10px;">
                <p style="max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{chat.fileName}}</p>
              </ion-col>
            </ion-row>
          </div>
          <div (click)="streamVideo(chat.textMessage)" *ngIf="chat.type == 'video'" class="msg" style="padding-top: 0rem; padding-bottom: 0rem; display: flex; flex-direction: row; width: 70%; background: #541585; border-radius: 0.5rem 0.5rem 0.5rem 0.2rem;">
            <ion-row>
              <ion-col size="1">
                <ion-icon style="position: relative; top: 17px; margin-right: 10px;" name="videocam"></ion-icon>
              </ion-col>
              <ion-col size="11" style="padding-left: 10px;">
                <p style="max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{chat.fileName}}</p>
              </ion-col>
            </ion-row>
          </div>
          <img *ngIf="chat.type == 'image'" src={{chat.textMessage}} style="font-size: 1.1rem; font-weight: 500; margin: 0.25rem 0; width: 60%; max-width: 80%; height: auto; max-height: 80%; border-radius: 0.7rem 0.7rem 0.7rem 0.2rem;">
      </div>


      <div *ngIf="chat.sender == uid" style=" display: flex; align-items:flex-end; justify-content:flex-end; width: 100%; ">
          <p *ngIf="chat.type == 'text'" [class]="chat.time >= lastSeenTime ? 'text-msg-seen' : 'msg-unseen'" style="padding: 0.5rem; margin: 0.25rem 0; color: white; box-shadow: -1px 2px 2px #00000026; font-size: 1.1rem; font-weight: 500; max-width: 80%; border-radius: 0.7rem 0.7rem 0.2rem 0.7rem;">{{chat.textMessage}}</p>
          <div *ngIf="chat.type == 'application'" (click)="openDoc(chat, i)" [class]="chat.time >= lastSeenTime ? 'msg-seen' : 'msg-unseen'" style="padding: 0.5rem; margin: 0.25rem 0; color: white; box-shadow: -1px 2px 2px #00000026; padding-top: 0rem; padding-bottom: 0rem; display: flex; flex-direction: row; width: 70%; border-radius: 0.5rem 0.5rem 0.2rem 0.5rem;">
            <ion-row>
              <ion-col size="1">
                <ion-spinner style="width: 20px; height: 20px; position: relative; top: 15px;" *ngIf="chat.fileDownload == true" name="crescent" color='secondary'></ion-spinner>
                <fa-icon style="position: relative; top: 15px;" *ngIf="chat.fileDownload == false" [icon]="chat.fileType"></fa-icon>
              </ion-col>
              <ion-col size="11">
                <p style="max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{chat.fileName}}</p>
              </ion-col>
            </ion-row>
          </div>
          <div (click)="streamAudio(chat.textMessage)" *ngIf="chat.type == 'audio'" [class]="chat.time >= lastSeenTime ? 'msg-seen' : 'msg-unseen'" style="padding: 0.5rem; margin: 0.25rem 0; color: white; box-shadow: -1px 2px 2px #00000026; max-height: 80px; padding-left: 5px; padding-right: 5px; margin: 0.25rem 0; border-radius: 0.5rem 0.5rem 0.2rem 0.5rem; color: white; width: 70%;">
            <ion-row style="max-width: 100%; text-overflow: ellipsis; position: relative; top: -5px;">
              <ion-col size='1'>
                <ion-icon name="headset" style="margin-bottom: -20px;"></ion-icon>
              </ion-col>
              <ion-col size='11' style="padding-left: 10px;">
                <p style="max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{chat.fileName}}</p>
              </ion-col>
            </ion-row>
          </div>
          <div (click)="streamVideo(chat.textMessage)" *ngIf="chat.type == 'video'" [class]="chat.time >= lastSeenTime ? 'msg-seen' : 'msg-unseen'" style="padding: 0.5rem; margin: 0.25rem 0; color: white; box-shadow: -1px 2px 2px #00000026; padding-top: 0rem; padding-bottom: 0rem; display: flex; flex-direction: row; width: 70%; border-radius: 0.5rem 0.5rem 0.2rem 0.5rem;">
            <ion-row>
              <ion-col size="1">
                <ion-icon style="position: relative; top: 17px; margin-right: 10px;" name="videocam"></ion-icon>
              </ion-col>
              <ion-col size="11" style="padding-left: 10px;">
                <p style="max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{chat.fileName}}</p>
              </ion-col>
            </ion-row>
          </div>
          <img *ngIf="chat.type == 'image'" src={{chat.textMessage}} style="font-size: 1.1rem; font-weight: 500; margin: 0.25rem 0; width: 60%; max-width: 80%; height: auto; max-height: 80%; border-radius: 0.7rem 0.7rem 0.2rem 0.7rem;">
      </div>
    </ion-item>
  </ion-list>

</ion-content>

<ion-footer style="overflow: hidden;">
  <ion-toolbar style="height: auto; --background: hsl(259, 55%, 17%); padding-left: 5px; padding-right: 5px;">
    <div [class]="record ? 'audio-input-show' : 'audio-input-hide'" style="width: 88%; height: 40px; margin-right: 5px; border-radius: 20px; background-color: white; transition: all 0.5s; position: absolute; display: flex; justify-content: space-between; padding-left: 20px; padding-right: 20px;">
      <ion-icon (click)="playPauseRecord()" style="position: relative; top: 50%; transform: translateY(-50%);" [name]="pause ? 'play' : 'pause'"></ion-icon>
      <h6 style="position: relative; bottom: 5px;">{{duration}}</h6>
      <ion-icon (click)="cancelRecord()" style="position: relative; top: 52%; transform: translateY(-52%);" name="close"></ion-icon>
    </div>
    <ion-input [class]="textMsg.length > 0 || record ? 'shorterInput' : 'normalInput'" [(ngModel)]="textMsg" placeholder="Type here....." style="transition: 0.5s; background: white; border-radius: 20px; --padding-start: 20px; --padding-end: 50px;"></ion-input>
    <ion-buttons [class]="textMsg.length > 0 || record  ? 'buttonsSlide' : 'buttonsNormalPos'" id="micBtn" style="transition: 0.6s; position: fixed; " color="primary" slot="end">
      <ion-button (click)="audioRecord()">
        <ion-icon slot="icon-only" name="mic" color="primary"></ion-icon>
      </ion-button>
      <ion-button (click)="openAttachModal()">
        <ion-icon slot="icon-only"  name="attach" color="primary"></ion-icon>
      </ion-button>
    </ion-buttons>


    <ion-fab-button [class]="textMsg.length > 0 || record ? 'sendBtn' : 'sendBtnSlide'" slot="end" (click)="sendTextMsg()" color='success' style='color: white; position: fixed; width: 40px; height: 40px; margin-right: 0px; transition: 0.5s;'>
      <ion-spinner *ngIf="sending == true" name="crescent" color="like"></ion-spinner>
      <ion-icon *ngIf="sending == false" name="chevron-forward-sharp"></ion-icon>
    </ion-fab-button>
  </ion-toolbar>
</ion-footer>




